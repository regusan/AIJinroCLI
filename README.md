# AIJinroCLI
Jinro game with AI

# プロジェクト概要
NPCエージェントおよびゲームマスターがAIである人狼ゲーム。任意数のユーザーが追加でき、AI同士の対戦の観戦も行える。
コンテキストによるゲーム状態(エージェントの生死など)管理と、自然言語ベースでのルール定義による、拡張性の高さの実証実験として開発する。

# 技術スタック
- Python
- richによるテキストベースのインターフェース
- GeminiCLI(Backend)

# 用語集
- 公開情報(publicGameState)=すべてのエージェント同士で共有しても問題ないもの。例：死亡情報など
- 秘密情報z(privateGameState)=各エージェントで秘めておく必要がある場合がある情報。例：占い結果など

# 仕様
- ゲームのステートは、基本的にコンテキストにより保持する
- エージェントのペルソナはテキストにより定義可能。デフォルトペルソナもあり。
- ロールもテキストにより定義されるが以下の仕様を満たす必要がある。
- 各エージェントはゲームマスターを通じた公開情報のみにアクセスでき、それを基に推論、行動する。
- 各エージェントのコンテキストは、物理的に別のものになるようにする。つまり、単一のコンテキストを使いまわして、"表面上"お互いの秘密情報を知らないフリしてゲームを進行していくことは阻止する。
- Geminiバックエンドでは、キャッシュの切り替えにより人格をシミュレーションする

## ロールプロンプトの仕様
- 行動タイプ(合意形成型、独立型)が必要(人狼が誰を殺すかは投票により決まるため、合意形成型、占い師は独立して行動するため、独立型)
- 勝利条件
- 陣営
- 

# ゲームの進行

## subroutin
### conversation
1. 引き数から議論エージェント配列、議論内容、議論ループ回数を受け取る
1. 議論ループ回数分イテレートする
    1. 各エージェントをイテレートする
        1. ゲームマスターは議論内容＋そのループでのそれまでの会話を付け、各エージェントに問うていく
1. ゲームマスターは、結論を集計し、そのテキストをリターン

## mainloop
1. ゲーム開始
1. 参加人数を決定、ゲームのロールを読み取り、ロール人数を指定
1. 参加エージェントデータ生成
1. ゲームマスターが各エージェントにロールを割り振る
1. ゲームループ開始
    1. 各役職についてイテレート
        1. 役職が
    1. すべてのエージェントから行動を聞き取ったら、行動内容を全エージェントに通知する。
    1. ゲーム終了処理判定
    1. エージェント間の議論開始。
        1. エージェントが順番に自身の考察を述べる。
        1. ゲームマスターは各エージェントに対して順番に考察を問うていく。
        1. 2番目以降のエージェントは、1番目、2番目...のエージェントの発言内容を伝える。
    1. 議論終了後、ゲームマスターは各エージェントにだれに追放投票するか問うていく
    1. 集計完了後、ゲームマスターは追放結果を各エージェントに共有していく。
    1. ゲームマスターは、ゲームステートを更新
    1. ゲーム終了処理判定

1. ゲーム終了判定
    1. ゲームマネージャーは、人狼の人数が市民の人数と同等以下になるか、人狼が消滅するかを、gameStateから判定する。
    1. ゲームマネージャーは終了条件なら、"GameEnd"を出力する。
    1. 先のゲームマスターの出力に"GameEnd"が含まれていればゲームループをブレイク

1. ゲーム終了処理
    1. ゲームの結果を各エージェントに通知
    1. 感想を各エージェントに問う(conversation)
    1. 終了



# クラス
- GameMaster
    - ゲームの進行を管理
    - variables
        - agents : Agent[]
        - roles: Role
        - publicGameState:str すべてのエージェントに公開可能なゲーム状態(例:死者など)
        - privateGameState:str すべてのエージェントに公開できないゲーム状態(例:誰が人狼か、占い結果など)
    - methods
        - void begin()
        - void gameloop()
        - void end()
        - string conversation(talktheme,agents,loopcount)
- Role
    - ロールの定義
    - constructor(name, prompt)
    - variables
        - name
        - prompt


- Agent
    - ロールを演じる
    - variables
        - role
        - persona
        - AgentBrain
    - methods
        - string talk(string text)
        - void notice(string text)


- Bra
    - AIモデルごとに異なる処理を記述する抽象クラス
    - methods
        - talk
        - void notice(string text)

- AgentBrainGemini
    - AgentBrainのGemini実装